<div class="client-container">
  <!-- Toolbar with Search -->
  <mat-toolbar color="primary" class="app-toolbar">
    <div class="logo">
      <span class="logo-lms">LMS</span>
      <span class="logo-full">Learning Management System</span>
    </div>
    
    <!-- User Info Section -->
    <div class="user-info-section">
      <mat-icon class="user-icon">person</mat-icon>
      <div class="user-details">
        <span class="user-name">{{ currentUser()?.username }}</span>
        <span class="user-role">{{ currentUser()?.isAdmin ? 'Admin' : 'User' }}</span>
      </div>
    </div>
    
    <!-- Search Bar -->
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>
        <input 
          matInput 
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          placeholder="Search courses and files..."
          [attr.aria-label]="'Global search'">
        <mat-spinner 
          *ngIf="isSearching()" 
          matSuffix 
          diameter="20">
        </mat-spinner>
        <button 
          *ngIf="searchQuery && !isSearching()" 
          matSuffix 
          mat-icon-button 
          (click)="closeSearch()"
          aria-label="Clear search">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <span class="toolbar-spacer"></span>

    <!-- Return to Search Button -->
    <button 
      *ngIf="canReturnToSearch()"
      mat-button
      (click)="returnToSearch()"
      class="return-search-btn">
      <mat-icon>arrow_back</mat-icon>
      <span class="btn-text">Back to Search</span>
    </button>

    <!-- Admin/Client View Button -->
    <button 
      *ngIf="currentUser()?.isAdmin" 
      mat-button 
      (click)="navigateToAdmin()"
      class="nav-btn">
      <mat-icon>admin_panel_settings</mat-icon>
      <span class="btn-text">Admin View</span>
    </button>

    <!-- Logout Button -->
    <button 
      mat-button 
      (click)="logout()"
      class="nav-btn">
      <mat-icon>logout</mat-icon>
      <span class="btn-text">Logout</span>
    </button>
  </mat-toolbar>

  <!-- Main Content Area -->
  <div class="content-area">
    
    <!-- SEARCH VIEW: Show search results grid -->
    <div *ngIf="currentView() === 'search'" class="search-view">
      <app-search-results-grid
        [query]="searchQueryText()"
        [results]="searchResults()"
        (selectItem)="onSearchItemSelect($event)"
        (closeSearch)="closeSearch()">
      </app-search-results-grid>
    </div>

    <!-- TREE VIEW: Show tree + viewer -->
    <div *ngIf="currentView() === 'tree'" class="tree-view">
      <!-- Left Panel: Tree -->
      <div class="left-panel" [style.width.px]="leftPanelWidth()">
        <app-tree-view 
          (fileSelected)="onFileSelected($event)"
          (folderSelected)="onFolderSelected($event)">
        </app-tree-view>
      </div>

      <!-- Resizer -->
      <div class="resizer"
           (mousedown)="onMouseDown($event)"
           [class.resizing]="isResizing()">
      </div>

      <!-- Right Panel: File/Folder Viewer -->
      <div class="right-panel">
        <!-- Overlay to block iframe events during resize -->
        <div class="resize-overlay" 
             [class.active]="isResizing()"
             (mouseup)="forceStopResize()"
             (click)="forceStopResize()"></div>
        
        @if (viewMode() === 'file' && selectedFile()) {
          <app-file-viewer [file]="selectedFile()!"></app-file-viewer>
        } @else if (viewMode() === 'folder' && selectedFolder()) {
          <app-folder-viewer 
            [folderId]="selectedFolder()!.folderId"
            [folderName]="selectedFolder()!.folderName"
            [courseId]="selectedFolder()!.courseId"
            (fileSelected)="onFileSelected($event)"
            (folderSelected)="onFolderSelected($event)">
          </app-folder-viewer>
        } @else {
          <div class="empty-state">
            <mat-icon>folder_open</mat-icon>
            <p>Select a file or folder from the tree to view</p>
          </div>
        }
      </div>
    </div>

  </div>
</div>
