<div class="full-height">
  <mat-toolbar class="app-toolbar">
    <span>LMS Admin Panel</span>
    <span class="toolbar-spacer"></span>
    <span class="user-info">{{ currentUser()?.username }}</span>
    <button mat-button (click)="navigateToClient()">
      <mat-icon>school</mat-icon>
      Client View
    </button>
    <button mat-button (click)="logout()">
      <mat-icon>logout</mat-icon>
      Logout
    </button>
  </mat-toolbar>

  <div class="content-container">
    <mat-tab-group [(selectedIndex)]="currentTab" class="admin-tabs">
      <mat-tab label="User Management">
        <div class="tab-content">
          <app-user-management></app-user-management>
        </div>
      </mat-tab>
      
      <mat-tab label="Folder Settings">
        <div class="tab-content">
          <div class="admin-content">
            <mat-card class="settings-card">
        <mat-card-header>
          <mat-card-title>Root Folder Settings</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Configure the root folder containing your learning materials.</p>
          <p class="hint">The system will automatically scan for Categories (Courses, Books, Novels, Pictures) and any custom folders.</p>
          
          <mat-form-field class="full-width">
            <mat-label>Root Folder Path</mat-label>
            <input matInput 
                   [(ngModel)]="rootPath" 
                   placeholder="e.g., C:\LearningMaterials"
                   (ngModelChange)="rootPath.set($event)">
          </mat-form-field>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="saveRootPath()">
              <mat-icon>save</mat-icon>
              Save Path
            </button>
            <button mat-raised-button color="accent" (click)="openUploadDialog()">
              <mat-icon>cloud_upload</mat-icon>
              Upload Course Folder
            </button>
            @if (isScanning()) {
              <button mat-raised-button color="accent" disabled>
                <mat-spinner diameter="20"></mat-spinner>
                Scanning...
              </button>
            } @else {
              <button mat-raised-button 
                      color="accent" 
                      (click)="scanFolder()" 
                      [disabled]="!rootPath()">
                <mat-icon>folder_open</mat-icon>
                Scan Folder
              </button>
            }
          </div>
        </mat-card-content>
      </mat-card>

      @if (scanResult()) {
        <mat-card class="results-card">
          <mat-card-header>
            <mat-card-title>Scan Results</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="scan-result">
              <div class="result-item">
                <mat-icon class="icon-success">check_circle</mat-icon>
                <span>Status: {{ scanResult()!.message }}</span>
              </div>
              <div class="result-item">
                <mat-icon>category</mat-icon>
                <span>Categories Found: {{ scanResult()!.categoriesFound }}</span>
              </div>
              <div class="result-item">
                <mat-icon>school</mat-icon>
                <span>Courses Found: {{ scanResult()!.coursesFound }}</span>
              </div>
              <div class="result-item">
                <mat-icon>add</mat-icon>
                <span>Files Added: {{ scanResult()!.filesAdded }}</span>
              </div>
              <div class="result-item">
                <mat-icon>remove</mat-icon>
                <span>Files Removed: {{ scanResult()!.filesRemoved }}</span>
              </div>
              <div class="result-item">
                <mat-icon>update</mat-icon>
                <span>Files Updated: {{ scanResult()!.filesUpdated }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      }
          </div>
        </div>
      </mat-tab>
      
      <mat-tab label="Backup & Restore">
        <div class="tab-content">
          <div class="admin-content">
            <!-- Database Backup & Restore Section -->
            <mat-card class="backup-card">
              <mat-card-header>
                <mat-card-title>Database Backup & Restore</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <p>Create backups and restore your database.</p>
                
                <div class="backup-actions">
                  <button mat-raised-button 
                          color="primary" 
                          (click)="createBackup()"
                          [disabled]="isBackupInProgress() || isRestoreInProgress() || backupStatus()?.is_locked">
                    @if (isBackupInProgress()) {
                      <mat-spinner diameter="20"></mat-spinner>
                    } @else {
                      <mat-icon>backup</mat-icon>
                    }
                    Create Backup
                  </button>
                  
                  <button mat-button (click)="loadBackups()">
                    <mat-icon>refresh</mat-icon>
                    Refresh List
                  </button>
                </div>
                
                @if (backupStatus()?.is_locked) {
                  <div class="status-container">
                    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                    <p class="status-text">
                      Operation in progress: {{ backupStatus()?.operation_type }}
                    </p>
                  </div>
                }
                
                <!-- Backups List -->
                <div class="backups-list">
                  @if (backups().length === 0) {
                    <p class="no-backups">No backups available</p>
                  } @else {
                    @for (backup of backups(); track backup.id) {
                      <mat-card class="backup-item">
                        <div class="backup-info">
                          <mat-icon class="backup-icon">folder_zip</mat-icon>
                          <div class="backup-details">
                            <h4>{{ backup.filename }}</h4>
                            <p>{{ backup.file_size | fileSize }} | {{ backup.created_at | date:'medium' }}</p>
                            <p>Created by: {{ backup.created_by }}</p>
                            @if (backup.notes) {
                              <p class="backup-notes">Notes: {{ backup.notes }}</p>
                            }
                          </div>
                        </div>
                        
                        <div class="backup-item-actions">
                          <button mat-icon-button 
                                  (click)="downloadBackup(backup)"
                                  title="Download">
                            <mat-icon>download</mat-icon>
                          </button>
                          
                          <button mat-icon-button 
                                  color="warn"
                                  (click)="restoreBackup(backup)"
                                  [disabled]="isBackupInProgress() || isRestoreInProgress() || backupStatus()?.is_locked"
                                  title="Restore">
                            <mat-icon>restore</mat-icon>
                          </button>
                          
                          <button mat-icon-button 
                                  color="warn"
                                  (click)="deleteBackup(backup)"
                                  title="Delete">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </div>
                      </mat-card>
                    }
                  }
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
